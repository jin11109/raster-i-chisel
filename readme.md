# Chisel RasterI
> This project is based on [Raster I](https://github.com/raster-gpu/raster-i), licensed under the MIT License.
> All modifications are done by GitHub user **jin11109** Â© 2025.

## Quick Start

> [!IMPORTANT]
> This project is currently a **work in progress**. The repository is divided into two main parts: the **Chisel core logic** (defining RasterI) and the **Verification suite** (used for functional testing).

### Prerequisites

- **Verilator**: v5.020 or newer
- **OS**: Ubuntu 22.04 / 24.04

### Build and Simulate RasterI (Chisel)
1. firtool requirement:
    ```bash
    $ wget https://github.com/llvm/circt/releases/download/firtool-1.40.0/firrtl-bin-ubuntu-20.04.tar.gz
    # After extract firrtl-bin-ubuntu-20.04.tar.gz
    $ export PATH=<your-path>/firrtl-bin-ubuntu-20.04/firtool-1.40.0/bin:$PATH
    ```
2. Generate resources data to `soc/src/main/resources`:
    ```bash
    # in tools
    $ make gen_hex
    ```
3. Navigate to the SoC directory:
    ```bash
    cd soc
    ``` 
4. Run simulation:
    Ensure your Verilator version is **5.020** or newer. This process compiles the Chisel code into Verilog and runs a simulation using Verilator.

    The simulation executes a basic test bench that processes 4 frames, reads the framebuffer data directly, and compares it against expected values.
    > This is currently a temporary verification setup. The goal is to transition this to a visual simulation (screen display) and relocate the verification process to `cosim`.

    ```bash
    make sim
    ```

## Verification
### Current Status:
- **C-Simulation (`c_sim`)**: Fully **functional**. It operates independently of Chisel and is built entirely in C++.
- **Cosimulation (`cosim`)**: Verifies the geometry stage and framebuffer by comparing the simulation memory against arrays defined in the Golden Reference.
    
#### Golden Reference Demo
To run the standalone C++ Golden Reference and view the rotating model:
1. Navigate to the verification directory:
    ```bash
    cd verification
    ```
2. Run C-Sim Demo:
    Execute the following command to view the golden reference result. The script will automatically download required libraries, compile the source, and display the output via SDL2.
    ```bash
    make csim
    ```
#### Co-simulation
1. Execute the command below to simulate both the Chisel renderer (RTL) and the Golden Reference (C++). The script will automatically compare their data. Should ensure there are resources data generated by `tools/gen_hex`.
    > Currently, this verification simulates a single frame at rotation angle 0.
    ```bash
    # in verification
    $ make cosim
    ```
    Expected Output:
    ```
    [INFO] Rendering Frame 0...
    [INFO] Start C++ simualtion ...
    [INFO] Start Varilator simulation ...
    [INFO] Frame 0 finished at cycle 229683
    [INFO] Start verification ...
    [INFO] Verifing geometry stage ...
    - memVertex compare to screen_vertices ...
    - memPos compare to transformed_positions ...
    - memNorm compare to transformed_normals ...
    - memBB compare to bounding_boxes ...
    [INFO] Verifing frambuffer ...
    [INFO] Frame 0 error count 0
    [INFO] Frame 0 verification done.
    [INFO] To view waveform: gtkwave ./cosim/trace.vcd
    ```
### Chisel Test for Submudole
- Test dataloader
    ```bash
    # in soc
    $ sbt "testOnly DataLoaderTest"
    ```
- Test Fixed point operation
    ```bash
    # in soc
    $ sbt "testOnly Fixed24_13Test"
    ```
